$('#carouselExample').on('slide.bs.carousel', function(e) {

    var $e = $(e.relatedTarget);
    var idx = $e.index();
    var itemsPerSlide = 3;
    var totalItems = $('.carousel-item-post').length;

    if (idx >= totalItems - (itemsPerSlide - 1)) {
        var it = itemsPerSlide - (totalItems - idx);
        for (var i = 0; i < it; i++) {
            // append slides to end
            if (e.direction == "left") {
                $('.carousel-item-post').eq(i).appendTo('.carousel-inner-post');
            } else {
                $('.carousel-item-post').eq(0).appendTo('.carousel-inner-post');
            }
        }
    }

    $('.carousel-item-post').removeClass('mt-3');
    var findActive = $('.carousel-item-post');
    for (let index = 0; index < findActive.length; index++) {
        var status = $('.carousel-item-post:nth-child(' + index + ')').hasClass("active");
        if (status) {
            var number = index + 2;
            $('.carousel-item-post:nth-child(' + number + ')').addClass('mt-3');
            return 0;
        }
        console.log(status);
    }
});

$(document).ready(function() {
    /* show lightbox when clicking a thumbnail */
    $('a.thumb').click(function(event) {
        event.preventDefault();
        var content = $('.modal-body');
        content.empty();
        var title = $(this).attr("title");
        $('.modal-title').html(title);
        content.html($(this).html());
        $(".modal-profile").modal({ show: true });
    });

});


function checkPhone(phone) {
    var vnf_regex = /((09|03|07|08|05)+([0-9]{8})\b)/g;
    if (vnf_regex.test(phone) == false) {
        return false;
    } else {
        return true;
    }
}

function checkEmail(email) {
    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (!filter.test(email)) {
        return false;
    } else {
        return true;
    }
}

$(document).ready(function() {
    $('#submitBTN').on('click', function() {
        var form = $(this).closest('form');
        var $this = $(this);
        var full_name = $('#full_name').val();
        var phone = $('#phone').val();
        var email = $('#email').val();
        var content = $('#content').val();

        if (full_name == '') {
            return bootbox.alert('Họ và tên không được để trống.');
        }
        if (phone == '') {
            return bootbox.alert('Số điện thoại không được bỏ trống.');
        }
        if (Number.isInteger(phone)) {
            return bootbox.alert('Số điện thoại không đúng định dạng.');
        }
        if (checkPhone(phone) == false) {
            return bootbox.alert('Số điện thoại không đúng định dạng.');
        }
        if (email == '') {
            return bootbox.alert('Email không được bỏ trống.');
        }
        if (checkEmail(email) == false) {
            return bootbox.alert('Email không đúng định dạng.');
        }
        if (content == '') {
            return bootbox.alert('Nội dung không hợp lệ.');
        }

        $.ajax({
            url: 'sources/ajax-contact.php',
            type: 'POST',
            dataType: 'json',
            data: { noi_dung: content, email: email, sdt: phone, full_name: full_name, action: 'contact' },
            beforeSend: function() {
                $('#submitBTNImage').attr('src', 'templates/assets/my/images/loading.gif');
            },
            success: function(data) {
                $('#submitBTNImage').attr('src', 'templates/assets/my/images/enter (1).png');

                if (data.constructor === String) {
                    data = JSON.parse(data);
                }

                if (data.success == true) {
                    $('#full_name').val('');
                    $('#phone').val('');
                    $('#email').val('');
                    $('#content').val('');
                }

                bootbox.alert(data.message);

            }
        });
    });

    $('#addEmailSubmit').on('click', function() {
        var email = $('#emailFile').val();

        if (email == '') {
            return bootbox.alert('Email không được bỏ trống.');
        }
        if (checkEmail(email) == false) {
            return bootbox.alert('Email không đúng định dạng.' + email);
        }

        $.ajax({
            url: 'sources/ajax-contact.php',
            type: 'POST',
            dataType: 'json',
            data: { email: email, action: 'email' },
            beforeSend: function() {
                $('#addEmailSubmit').text('Đang gửi');
            },
            success: function(data) {
                $('#addEmailSubmit').attr('Đăng ký');

                if (data.constructor === String) {
                    data = JSON.parse(data);
                }

                if (data.success == true) {
                    $('#emailFile').val('');
                }

                bootbox.alert(data.message);

            }
        });
    });

    $('#submitRecruitment').on('click', function() {
        var full_name = $('#full_name').val();
        var phone = $('#phone').val();
        var email = $('#email').val();
        var recruitment = $('#recruitment').val();

        if (full_name == '') {
            return bootbox.alert('Họ và tên không được để trống.');
        }
        if (phone == '') {
            return bootbox.alert('Số điện thoại không được bỏ trống.');
        }
        if (Number.isInteger(phone)) {
            return bootbox.alert('Số điện thoại không đúng định dạng.');
        }
        if (checkPhone(phone) == false) {
            return bootbox.alert('Số điện thoại không đúng định dạng.');
        }
        if (recruitment == '') {
            return bootbox.alert('Vị trí ứng tuyển không được bỏ trống.');
        }
        if (email == '') {
            return bootbox.alert('Email không được bỏ trống.' + email);
        }
        if (checkEmail(email) == false) {
            return bootbox.alert('Email không đúng định dạng.');
        }

        $.ajax({
            url: 'sources/ajax-contact.php',
            type: 'POST',
            dataType: 'json',
            data: { email: email, phone: phone, recruitment: recruitment, ho_ten: full_name, action: 'recruitment' },
            beforeSend: function() {
                $('#addEmailSubmit').text('Đang gửi');
            },
            success: function(data) {
                $('#addEmailSubmit').attr('Đăng ký');

                if (data.constructor === String) {
                    data = JSON.parse(data);
                }

                if (data.success == true) {
                    $('#emailFile').val('');
                }

                bootbox.alert(data.message);

            }
        });
    });



    function loadPost() {
        $('.carousel-item-post').removeClass('mt-3');
        var findActive = $('.carousel-item-post');
        for (let index = 0; index < findActive.length; index++) {
            var status = $('.carousel-item-post:nth-child(' + index + ')').hasClass("active");
            if (status) {
                var number = index + 1;
                $('.carousel-item-post:nth-child(' + number + ')').addClass('mt-3');
                return 0;
            }
            console.log(status);
        }
    }
    loadPost();
});


$('#sub-content-slider .main-img-slider').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    infinite: true,
    arrows: true,
    fade: true,
    autoplay: true,
    autoplaySpeed: 4000,
    speed: 300,
    lazyLoad: 'ondemand',
    asNavFor: '.thumb-nav',
    prevArrow: '<div class="slick-prev"><i class="i-prev"></i><span class="sr-only sr-only-focusable">Previous</span></div>',
    nextArrow: '<div class="slick-next"><i class="i-next"></i><span class="sr-only sr-only-focusable">Next</span></div>'
});

$('.thumb-nav').slick({
    slidesToShow: 4,
    slidesToScroll: 1,
    infinite: true,
    centerPadding: '0px',
    asNavFor: '.main-img-slider',
    dots: false,
    centerMode: false,
    draggable: true,
    speed: 200,
    focusOnSelect: true,
    prevArrow: '<div class="slick-prev"><i class="i-prev"></i><span class="sr-only sr-only-focusable">Previous</span></div>',
    nextArrow: '<div class="slick-next"><i class="i-next"></i><span class="sr-only sr-only-focusable">Next</span></div>'
});

$('.main-img-slider').on('afterChange', function(event, slick, currentSlide, nextSlide) {
    $('.thumb-nav .slick-slide').removeClass('slick-current');
    $('.thumb-nav .slick-slide:not(.slick-cloned)').eq(currentSlide).addClass('slick-current');
});